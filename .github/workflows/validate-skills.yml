name: Validate Skills

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  validate-skills:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: Install skills-ref
        run: |
          # Clone the agentskills repository
          # Note: Using main branch. Consider pinning to a specific commit/tag once stable releases are available.
          git clone --depth 1 https://github.com/agentskills/agentskills.git
          cd agentskills/skills-ref
          pip install -e .

      - name: Validate all skills
        run: |
          echo "üîç Validating all skills..."
          
          # Find all SKILL.md files and validate their parent directories
          find skills -name "SKILL.md" | while read -r skill_file; do
            skill_dir=$(dirname "$skill_file")
            skill_name=$(basename "$skill_dir")
            
            echo ""
            echo "Validating $skill_name..."
            
            if skills-ref validate "$skill_dir"; then
              echo "‚úÖ $skill_name is valid"
            else
              echo "‚ùå $skill_name validation failed"
              exit 1
            fi
          done
          
          echo ""
          echo "‚úÖ All skills validated successfully"
